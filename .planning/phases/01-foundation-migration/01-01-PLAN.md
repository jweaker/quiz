---
phase: 01-foundation-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - index.html
  - tsconfig.json
  - package.json
  - src/vite-env.d.ts
autonomous: true

must_haves:
  truths:
    - "npm run dev starts Vite dev server with HMR on localhost"
    - "npm run build creates production bundle in dist/ folder"
    - "TypeScript files are recognized by Vite (no compile errors on .tsx)"
  artifacts:
    - path: "vite.config.ts"
      provides: "Vite configuration with React plugin"
      contains: "@vitejs/plugin-react"
    - path: "index.html"
      provides: "Vite entry point at project root"
      contains: "src/main.tsx"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "compilerOptions"
    - path: "src/vite-env.d.ts"
      provides: "Vite client types"
      contains: "vite/client"
  key_links:
    - from: "index.html"
      to: "src/main.tsx"
      via: "script module import"
      pattern: "src/main\\.tsx"
    - from: "vite.config.ts"
      to: "@vitejs/plugin-react"
      via: "plugin array"
      pattern: "react\\(\\)"
---

<objective>
Migrate from Create React App to Vite 7 with React plugin and TypeScript foundation.

Purpose: Establish modern build tooling with instant HMR before migrating code. The app currently uses CRA (react-scripts 5.0.1) which is slow and deprecated.
Output: Working Vite dev server that can run TypeScript React files, ready for the codebase conversion.
</objective>

<execution_context>
@/Users/jweaker/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/jweaker/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-migration/01-RESEARCH.md

# Current codebase entry point
@src/index.js
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vite and configure build system</name>
  <files>
    package.json
    vite.config.ts
    tsconfig.json
    tsconfig.node.json
    src/vite-env.d.ts
  </files>
  <action>
1. Remove CRA dependencies:
   - Remove react-scripts, web-vitals from dependencies
   - Remove eslintConfig and browserslist from package.json

2. Install Vite and TypeScript:
   ```bash
   npm install -D vite @vitejs/plugin-react typescript @types/react @types/react-dom
   ```

3. Create vite.config.ts at project root:
   ```ts
   import { defineConfig } from 'vite'
   import react from '@vitejs/plugin-react'

   export default defineConfig({
     plugins: [react()],
   })
   ```

4. Create tsconfig.json with strict settings (per research - strict mode):
   ```json
   {
     "compilerOptions": {
       "target": "ES2022",
       "lib": ["ES2022", "DOM", "DOM.Iterable"],
       "module": "ESNext",
       "skipLibCheck": true,
       "moduleResolution": "bundler",
       "allowImportingTsExtensions": true,
       "isolatedModules": true,
       "moduleDetection": "force",
       "noEmit": true,
       "jsx": "react-jsx",
       "strict": true,
       "noUnusedLocals": true,
       "noUnusedParameters": true,
       "noFallthroughCasesInSwitch": true,
       "noUncheckedIndexedAccess": true
     },
     "include": ["src"]
   }
   ```

5. Create tsconfig.node.json for Vite config:
   ```json
   {
     "compilerOptions": {
       "target": "ES2022",
       "lib": ["ES2022"],
       "module": "ESNext",
       "skipLibCheck": true,
       "moduleResolution": "bundler",
       "allowImportingTsExtensions": true,
       "isolatedModules": true,
       "moduleDetection": "force",
       "noEmit": true,
       "strict": true
     },
     "include": ["vite.config.ts"]
   }
   ```

6. Create src/vite-env.d.ts:
   ```ts
   /// <reference types="vite/client" />
   ```

7. Update package.json scripts:
   ```json
   "scripts": {
     "dev": "vite",
     "build": "tsc -b && vite build",
     "preview": "vite preview"
   }
   ```
  </action>
  <verify>
    - `npm install` completes without errors
    - `npx tsc --noEmit` shows no config errors (source files will have errors - that's expected)
    - vite.config.ts exists and imports react plugin
  </verify>
  <done>
    - Vite and TypeScript dependencies installed
    - vite.config.ts configured with React plugin
    - tsconfig.json configured with strict mode
    - package.json scripts updated for Vite
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Vite entry point and rename main file</name>
  <files>
    index.html
    src/main.tsx
    public/index.html (delete)
  </files>
  <action>
1. Move index.html from public/ to project root (Vite convention):
   - Copy content from public/index.html
   - Add Vite script entry: `<script type="module" src="/src/main.tsx"></script>` in body
   - Remove %PUBLIC_URL% references (Vite doesn't use them)
   - Keep the root div: `<div id="root"></div>`

2. Create the new index.html at project root:
   ```html
   <!DOCTYPE html>
   <html lang="ar" dir="rtl">
     <head>
       <meta charset="UTF-8" />
       <meta name="viewport" content="width=device-width, initial-scale=1.0" />
       <title>بشائر المعرفة</title>
     </head>
     <body>
       <div id="root"></div>
       <script type="module" src="/src/main.tsx"></script>
     </body>
   </html>
   ```
   Note: Set lang="ar" and dir="rtl" now per user decisions (RTL for all content).

3. Rename src/index.js to src/main.tsx (Vite convention):
   - This is just a rename for now
   - Keep the content as-is (will be properly converted in Plan 02)
   - Add minimal type assertions to make it compile:
     ```tsx
     const root = ReactDOM.createRoot(document.getElementById("root") as HTMLElement);
     ```

4. Delete public/index.html (no longer needed with Vite).

5. Move remaining public/ assets if any to public/ (Vite serves public/ as static).
  </action>
  <verify>
    - index.html exists at project root with script pointing to src/main.tsx
    - src/main.tsx exists (renamed from index.js)
    - public/index.html is deleted
    - `npm run dev` starts and shows the app (may have TS errors in console but renders)
  </verify>
  <done>
    - Vite dev server starts successfully with `npm run dev`
    - App renders in browser (even if with type errors in console)
    - Entry point follows Vite conventions (index.html at root, main.tsx import)
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` - Vite dev server starts on localhost (typically :5173)
2. Open browser - app renders (may have console errors but UI appears)
3. Run `npm run build` - creates dist/ folder with production bundle
4. Check `ls dist/` shows index.html and assets folder
</verification>

<success_criteria>
- Vite 7+ dev server runs with instant HMR
- TypeScript compiler recognizes .tsx files
- Build produces dist/ folder
- No react-scripts dependency remains
- index.html at project root with module script to src/main.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-migration/01-01-SUMMARY.md`
</output>
