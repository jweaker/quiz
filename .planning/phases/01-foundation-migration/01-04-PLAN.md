---
phase: 01-foundation-migration
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - vite.config.ts
  - src/styles/main.css
  - src/styles/fonts.css
  - public/fonts/Cairo-Regular.woff2
  - public/fonts/Cairo-Bold.woff2
  - src/main.tsx
  - src/App.tsx
  - src/App.css (delete)
  - src/index.css (delete)
  - src/screens/*.css (delete all)
  - src/components/*.css (delete all)
autonomous: true

must_haves:
  truths:
    - "All CSS uses logical properties (ps/pe/ms/me, text-start/end) not left/right"
    - "dir=rtl is set on root element in index.html"
    - "Cairo font loads and renders Arabic text"
    - "No CDN font dependencies (fonts self-hosted)"
  artifacts:
    - path: "src/styles/main.css"
      provides: "Tailwind entry point with RTL setup"
      contains: "@tailwind"
    - path: "src/styles/fonts.css"
      provides: "Self-hosted Cairo font-face declarations"
      contains: "@font-face"
    - path: "public/fonts/Cairo-Regular.woff2"
      provides: "Self-hosted Arabic font file"
  key_links:
    - from: "src/main.tsx"
      to: "src/styles/main.css"
      via: "import"
      pattern: "import.*styles/main.css"
    - from: "src/styles/main.css"
      to: "src/styles/fonts.css"
      via: "@import"
      pattern: "@import.*fonts"
    - from: "vite.config.ts"
      to: "@tailwindcss/vite"
      via: "plugin"
      pattern: "tailwindcss"
---

<objective>
Set up Tailwind CSS v4 with RTL-first logical properties and self-hosted Cairo font.

Purpose: Fulfill the RTL requirement from user decisions (dir="rtl", logical properties) and ensure broadcast independence (self-hosted fonts, no CDN). This plan runs parallel to 01-03.
Output: Tailwind-based styling with RTL support, Cairo font loaded locally, all old CSS deleted.
</objective>

<execution_context>
@/Users/jweaker/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/jweaker/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation-migration/01-CONTEXT.md
@.planning/phases/01-foundation-migration/01-RESEARCH.md
@.planning/phases/01-foundation-migration/01-02-SUMMARY.md

# Current CSS files to be replaced
@src/App.css
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tailwind v4 and configure for Vite</name>
  <files>
    vite.config.ts
    src/styles/main.css
  </files>
  <action>
1. Install Tailwind v4 and Vite plugin:
   ```bash
   npm install -D tailwindcss @tailwindcss/vite
   ```

2. Update vite.config.ts to add Tailwind plugin:
   ```ts
   import { defineConfig } from 'vite'
   import react from '@vitejs/plugin-react'
   import tailwindcss from '@tailwindcss/vite'

   export default defineConfig({
     plugins: [react(), tailwindcss()],
   })
   ```

3. Create src/styles/ directory.

4. Create src/styles/main.css as Tailwind entry point:
   ```css
   @import "tailwindcss";
   @import "./fonts.css";

   /* RTL-first theme configuration */
   @theme {
     --font-display: "Cairo", sans-serif;
     --font-body: "Cairo", sans-serif;
   }

   /* Base styles - RTL by default */
   html {
     font-family: var(--font-body);
   }

   /* Ensure Western numerals for scores/timers */
   .western-numerals {
     font-variant-numeric: lining-nums;
     font-feature-settings: "lnum";
   }
   ```

5. Tailwind v4 uses CSS-first configuration - no tailwind.config.js needed.
  </action>
  <verify>
    - vite.config.ts includes tailwindcss plugin
    - src/styles/main.css exists with @import "tailwindcss"
    - `npm run dev` starts without errors
  </verify>
  <done>
    - Tailwind v4 installed with Vite plugin
    - Main CSS entry point created
    - Theme configured for Cairo font
  </done>
</task>

<task type="auto">
  <name>Task 2: Self-host Cairo font and configure font-face</name>
  <files>
    public/fonts/Cairo-Regular.woff2
    public/fonts/Cairo-Bold.woff2
    src/styles/fonts.css
  </files>
  <action>
1. Create public/fonts/ directory.

2. Download Cairo font from Google Fonts (self-hosted):
   - Download Cairo woff2 files from google-webfonts-helper or fontsource
   - We need Regular (400) and Bold (700) weights minimum
   - Place in public/fonts/:
     - Cairo-Regular.woff2
     - Cairo-Bold.woff2
   
   Alternative using curl (font files from Google Fonts CDN, then self-host):
   ```bash
   mkdir -p public/fonts
   # Download from CDN once, store locally
   curl -o public/fonts/Cairo-Regular.woff2 "https://fonts.gstatic.com/s/cairo/v28/SLXgc1nY6HkvalIvTp2mxdt0.woff2"
   curl -o public/fonts/Cairo-Bold.woff2 "https://fonts.gstatic.com/s/cairo/v28/SLXgc1nY6Hkvalr5T52mx9t0.woff2"
   ```

3. Create src/styles/fonts.css with @font-face declarations:
   ```css
   /* Self-hosted Cairo font for broadcast independence */
   @font-face {
     font-family: 'Cairo';
     font-style: normal;
     font-weight: 400;
     font-display: swap;
     src: url('/fonts/Cairo-Regular.woff2') format('woff2');
   }

   @font-face {
     font-family: 'Cairo';
     font-style: normal;
     font-weight: 700;
     font-display: swap;
     src: url('/fonts/Cairo-Bold.woff2') format('woff2');
   }
   ```

4. Note: Files in public/ are served at root path, so /fonts/Cairo-Regular.woff2 works.
  </action>
  <verify>
    - public/fonts/Cairo-Regular.woff2 and Cairo-Bold.woff2 exist
    - src/styles/fonts.css has @font-face declarations
    - `npm run dev` - check Network tab shows fonts loading from localhost (not googleapis.com)
    - Arabic text renders in Cairo font
  </verify>
  <done>
    - Cairo font files self-hosted in public/fonts/
    - @font-face declarations load local fonts
    - No external CDN requests for fonts
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate components to Tailwind with logical properties</name>
  <files>
    src/main.tsx
    src/App.tsx
    src/screens/Home.tsx
    src/screens/Windows.tsx
    src/screens/QuestionPicker.tsx
    src/screens/Question.tsx
    src/screens/Rate.tsx
    src/screens/Set.tsx
    src/components/Score.tsx
    src/components/IconButton.tsx
  </files>
  <action>
1. Update src/main.tsx to import the new Tailwind entry:
   ```tsx
   import './styles/main.css'
   // Remove: import './index.css'
   ```

2. Verify index.html already has dir="rtl" and lang="ar" (set in Plan 01).

3. For each component, replace CSS class imports with Tailwind utilities:

   **Logical property mappings (RTL-safe):**
   - margin-left/right → ms-X/me-X (margin-start/end)
   - padding-left/right → ps-X/pe-X (padding-start/end)
   - text-align: left/right → text-start/text-end
   - left/right positioning → start-X/end-X
   - border-left/right → border-s/border-e

   **Example conversion:**
   ```tsx
   // Before (in CSS file):
   .container { margin-left: 20px; padding-right: 16px; text-align: right; }
   
   // After (in JSX):
   <div className="ms-5 pe-4 text-end">
   ```

4. Convert each file:

   **src/App.tsx:**
   - Remove: `import './App.css'`
   - Replace className="App" with Tailwind classes
   - `hideCursor` class: use `cursor-none` conditional

   **src/screens/Home.tsx:**
   - Remove: CSS import
   - Convert layout/spacing to Tailwind utilities

   **src/screens/Windows.tsx, QuestionPicker.tsx, Question.tsx, Rate.tsx, Set.tsx:**
   - Same pattern: remove CSS import, convert to Tailwind
   - Use logical properties for all spacing/alignment

   **src/components/Score.tsx:**
   - Remove: CSS import
   - Add `western-numerals` class for score numbers
   - Use Tailwind for layout

   **src/components/IconButton.tsx:**
   - Remove: CSS import
   - Convert button styles to Tailwind

5. Score panel spatial layout (per user decision):
   - Left team stays visually left, right team stays visually right
   - Use explicit positioning or flex with `flex-row` (not affected by RTL)
   - Wrap score panel in `dir="ltr"` if needed to lock spatial positioning:
     ```tsx
     <div dir="ltr" className="flex flex-row">
       <ScorePanel team="left" />
       <ScorePanel team="right" />
     </div>
     ```

6. Delete all old CSS files:
   - src/App.css
   - src/index.css
   - src/screens/*.css (all)
   - src/components/*.css (all)
  </action>
  <verify>
    - `find src -name "*.css" | grep -v styles` returns empty (no CSS outside styles/)
    - `npm run dev` - app renders with correct styling
    - Arabic text is right-aligned by default
    - Score panels show left team on left, right team on right (spatial)
    - Inspect element - no left/right CSS properties, only logical properties
  </verify>
  <done>
    - All components use Tailwind utility classes
    - All spacing/alignment uses logical properties
    - Old CSS files deleted
    - Score panels maintain spatial positioning in RTL context
    - Cairo font renders throughout the app
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` - app starts and renders correctly
2. Inspect any element - font-family is "Cairo"
3. Network tab shows font files from localhost, not googleapis.com
4. Check document dir attribute: `document.documentElement.dir` is "rtl"
5. `find src -name "*.css"` shows only src/styles/main.css and src/styles/fonts.css
6. View app - text flows RTL, scores are in Western numerals
7. `npm run build` succeeds
</verification>

<success_criteria>
- Tailwind v4 configured with Vite plugin
- Cairo font self-hosted (no CDN dependency)
- dir="rtl" on root element
- All CSS uses logical properties (ps/pe/ms/me, text-start/end)
- Western numerals for scores/timers
- No old CSS files remain
- Build succeeds with all styling intact
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-migration/01-04-SUMMARY.md`
</output>
